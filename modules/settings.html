<div id="settings">
  <label>Username:</label></br>
  <input type="text" id="settings-username">
  <label>Email:</label></br>
  <input type="text" id="settings-email">
  <hr>
  <label>Password:</label></br>
  <input type="text" id="settings-password">
  <button type="submit">Update Settings</button>
</div>
<script>
$(document).ready(function() {
        firebase.auth().onAuthStateChanged(function(user) {
                if (user) {
                        $("input#settings-username").val(user.displayName);
                        $("input#settings-email").val(user.email);
                        $("div#settings").on("click", "button[type='submit']", function() {
                                var newUsername = $("input#settings-username").val();
                                var newEmail = $("input#settings-email").val();
                                var password = $("input#settings-password").val();
                                user.updateProfile({
                                        displayName: newUsername
                                }).then(function() {
                                        firebase.firestore().collection("users").doc(user.uid).collection("preferences").doc("profile").update({
                                                displayName: newUsername
                                }).then(function() {
                                        displaySuccess("Username updated successfully.");
                                });
                        }).catch(function(e) {
                                displayError("Username could not be updated.");
                        });
                        firebase.auth().signInWithEmailAndPassword(user.email, password).then(function(userCredential) {
                                userCredential.user.updateEmail(newEmail).then(function() {
                                        displaySuccess("Email address updated.");
                                });
                        }).catch(function(e) {
                                displayError("Enter your current password to update email address.");
                        });
                }
        });
});
</script>
